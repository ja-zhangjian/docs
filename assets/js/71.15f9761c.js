(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{420:function(t,s,n){"use strict";n.r(s);var a=n(25),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"收集七-异步进阶"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#收集七-异步进阶"}},[t._v("#")]),t._v(" 收集七(异步进阶)")]),t._v(" "),n("p",[t._v("event-loop、promise 进阶、async、awit、微任务、宏任务")]),t._v(" "),n("p",[t._v("题目")]),t._v(" "),n("ol",[n("li",[t._v("请描述 eventloop 的机制，可画图")]),t._v(" "),n("li",[t._v("什么是宏任务和微任务，两者的区别？")]),t._v(" "),n("li",[t._v("promise 有哪些状态？")]),t._v(" "),n("li",[t._v("promise then 和 catch 的连接")])]),t._v(" "),n("img",{attrs:{src:t.$withBase("/面试/promisecatch.png")}}),t._v(" "),n("p",[t._v("答案：13、123、12")]),t._v(" "),n("ol",{attrs:{start:"5"}},[n("li",[t._v("async/awit 语法问题")])]),t._v(" "),n("img",{attrs:{src:t.$withBase("/面试/asyncawit.png")}}),t._v("\n答案：promise，值为100、100\n"),n("p",[t._v("start、100、200、报错")]),t._v(" "),n("ol",{attrs:{start:"6"}},[n("li",[t._v("promise 和 setTimeout 的顺序")])]),t._v(" "),n("img",{attrs:{src:t.$withBase("/面试/promise 和 setTimeout.png")}}),t._v(" "),n("p",[t._v("100、400、300、200")]),t._v(" "),n("ol",{attrs:{start:"7"}},[n("li",[t._v("async/awit 顺序问题")])]),t._v(" "),n("img",{attrs:{src:t.$withBase("/面试/asyncawit顺序.png")}}),t._v(" "),n("p",[t._v("awit 后面接 promise 相当于.then()，接数值，相当于直接返回值")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"async1 start"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这一句会同步执行，返回 Promise ，其中的 `console.log('async2')` 也会同步执行")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"async1 end"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//6")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上面有 await ，下面就变成了“异步”，类似 cakkback 的功能（微任务）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"async2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script start"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异步，宏任务")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setTimeout"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//8")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回 Promise 之后，即同步执行完成，then 是异步代码")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promise 的函数体会立刻执行//4")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异步，微任务")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//7")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script end"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//5")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同步代码执行完之后，屡一下现有的异步未执行的，按照顺序")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. async1 函数中 await 后面的内容 —— 微任务")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. setTimeout —— 宏任务")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. then —— 微任务")]),t._v("\n")])])]),n("p",[t._v("知识点")]),t._v(" "),n("p",[t._v("eventloop:js 如何执行的？先同步，再异步")]),t._v(" "),n("ul",[n("li",[t._v("过程")])]),t._v(" "),n("p",[t._v("同步代码，一行一行在 call stack 执行")]),t._v(" "),n("p",[t._v("遇到异步，记录 webapis，等待时机（定时，网络请求）")]),t._v(" "),n("p",[t._v("时机到了移到 callback queue")]),t._v(" "),n("p",[t._v("如 call stack 为空，eventloop 开始工作")]),t._v(" "),n("p",[t._v("轮询查找 callback queue，有则放到 callback 执行")]),t._v(" "),n("p",[t._v("继续轮询查找")]),t._v(" "),n("ul",[n("li",[t._v("DOM 事件和 eventloop")])]),t._v(" "),n("p",[t._v("异步（setTimeout，ajax 等）使用回调、DOM 事件也是使用回调，基于 eventloop")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("promise")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("三种状态")]),t._v(" "),n("p",[t._v("pending、resolved、rejected")]),t._v(" "),n("p",[t._v("pending、=>(pending/resolved)、rejected")]),t._v(" "),n("p",[t._v("变化不可逆")])]),t._v(" "),n("li",[n("p",[t._v("状态的表现和变化")])]),t._v(" "),n("li",[n("p",[t._v("then 和 catch 对状态的影响")]),t._v(" "),n("p",[t._v("then/catch 正常返回 resolved，里面有报错则返回 rejected")])])])]),t._v(" "),n("li",[n("p",[t._v("async/await")]),t._v(" "),n("p",[t._v("async/await 同步语法，彻底消灭回调函数")]),t._v(" "),n("p",[t._v("async/await 和 promise 的关系")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("执行 async 函数，返回的是 promise 对象")])]),t._v(" "),n("li",[n("p",[t._v("await 后面是 promise 才相当于 promise 的 then，后面是值，则返回值")])]),t._v(" "),n("li",[n("p",[t._v("try...catch 可以捕获异常，代替了 promise 的 catch")])])])]),t._v(" "),n("li",[n("p",[t._v("异步的本质：js 是单线程的，不管如何，都是基于 eventloop")])]),t._v(" "),n("li",[n("p",[t._v("await 后面的（下面的），可以看做是 callback 里的内容，即异步。类似 eventloop")])]),t._v(" "),n("li",[n("p",[t._v("for...of 常用于异步的遍历")])]),t._v(" "),n("li",[n("p",[t._v("总结，async/await 解决异步回调，语法糖，与 promise 的关系：补充")])]),t._v(" "),n("li",[n("p",[t._v("宏任务 macroTask/微任务 microTask")])])]),t._v(" "),n("p",[t._v("宏任务:setTimeout/setInterval，ajax，dom 事件")]),t._v(" "),n("p",[t._v("微任务：promise async/await")]),t._v(" "),n("p",[t._v("微任务执行时机比宏任务要早")]),t._v(" "),n("p",[t._v("当 callstack 空闲时，会尝试 DOM 渲染，然后触发 eventloop")]),t._v(" "),n("p",[t._v("微任务：dom 渲染前触发，如 promise；宏任务：dom 渲染后触发，如 setTimeout")]),t._v(" "),n("p",[t._v("执行 promise 会直接放入 microtaskqueue 里面，不会经过 webapis，因为 promise 是 es 规范不是 w3c 的规范")]),t._v(" "),n("p",[t._v("微任务是 es6 语法规定，宏任务是浏览器规定的")]),t._v(" "),n("p",[n("code",[t._v("call stack 清空，执行当前的微任务，尝试 dom 渲染，触发 eventloop")])])])}),[],!1,null,null,null);s.default=e.exports}}]);